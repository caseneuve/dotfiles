#!/bin/bash

# Path:        ~/.dotfiles/bin/scratchpad.sh
# Created:     13.10.18, 01:19    @lenovo
# Last update: 24.01.19, 18:03:25 @toshiba

# >> DOC: 
# i3config helper: start tmux scratchpad if doesn't exist or show it
# requires: i3move; i3get

# >> VARIABLES:
TRMNL=st
ST_CFG=~/git/hub/st/config.def.h

if [[ $TRMNL == st ]]; then
    font=$(awk '/^static char \*font/ {print $5}' $ST_CFG)
    font=${font%%:*}
    font=${font/\"/}
fi

# >> RUN:
while getopts "ufcot:" flag; do
    case "${flag}" in
        # >>> tmux
        u) if [[ ! $(ps aux | grep dropdown | grep -v grep) ]]; then
               i3-msg -q "exec --no-startup-id $TRMNL -c scratch -t dropdown -e ~/.dotfiles/bin/tmux-starter.sh" &&\
                   sleep 0.1
               i3-msg -q "[title=\"dropdown\"] scratchpad show"
               ~/bin/i3move -p 70 -m c
           else
               i3-msg -q "[title=\"dropdown\"] scratchpad show"
               [[ $(~/git/lab/py-exercises/i3get.py -n) =~ "dropdown" ]] && ~/bin/i3move -p 70 -m c
               # wwid=$(~/git/lab/py-exercises/i3get.py -g | awk 'NR==3 {print $2}')
               # swid=$(~/git/lab/py-exercises/i3get.py -G | awk 'NR==3 {print $2}')
               # proc=$(bc -l <<< $wwid/$swid)
               # if [[ $(echo $proc'==0.7' | bc -l) == 0 ]] && [[ $(~/git/lab/py-exercises/i3get.py -n) =~ "dropdown" ]]; then
               #     ~/bin/i3move -p 70 -m c
               # fi
               # if [[ $(~/git/lab/py-exercises/i3get.py -n) =~ "dropdown" ]]; then
               #     i3-msg -q "border pixel 1"
               # fi
           fi
           ;;
        # >>> quick scratch
        f) if [[ ! $(ps aux | grep myquickterm | grep -v grep) ]]; then
               i3-msg -q "exec --no-startup-id $TRMNL -c myquickterm -f '$font:size=13'" &&\
                   sleep 0.1
           fi
           i3-msg -q "[class=\"myquickterm\"] scratchpad show" &&
               if [[ $(~/git/lab/py-exercises/i3get.py -c) =~ myquickterm ]]; then
                   ~/bin/i3move -s -m 3;
                   # i3-msg -q "border pixel 1"
               fi
           ;;
        # >>> calc
        c) if [[ ! $(ps aux | grep m4ath | grep -v grep ) ]]; then
               i3-msg -q "exec --no-startup-id $TRMNL -c calculator -t m4ath -e R -q" &&\
                   sleep 0.1
           fi
           i3-msg -q "[class=\"calculator\"] scratchpad show" &&
               if [[ $(~/git/lab/py-exercises/i3get.py -c) =~ calculator ]]; then
                   ~/bin/i3move -m c;
                   # i3-msg -q "border pixel 1"
               fi
           ;;
        # >>> words
        o) if [[ ! $(ps aux | grep w0rds | grep -v grep) ]]; then
               i3-msg -q "exec --no-startup-id $TRMNL -c whit4ker -t w0rds -e words" &&\
                   sleep 0.1
           fi
           i3-msg -q "[title=\"w0rds\"] scratchpad show" &&
               if [[ $(~/git/lab/py-exercises/i3get.py -c) =~ whit4ker ]]; then
                   ~/bin/i3move -p 35 -g 10 -m sw
                   # i3-msg -q "border pixel 1"
               fi
           ;;
        # >>> clock
        t) if [[ ! $(ps aux | grep cl0ck | grep -v grep) ]]; then
               i3-msg -q "exec --no-startup-id $TRMNL -c cl0ck -t tty-clock -f '$font:size=10' -e tty-clock -C $OPTARG -c -b" &&\
                   sleep 0.1
           fi
           if [[ $(~/git/lab/py-exercises/i3get.py -c) =~ cl0ck ]]; then
               ~/bin/i3move -p 22 -g 15 -m se
               i3-msg -q "sticky enable"
           fi
           ;;
    esac
done
